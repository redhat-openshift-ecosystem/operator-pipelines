
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../community-operators-troubleshooting/" rel="prev"/>
<link href="../dynamic_checks/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.14" name="generator"/>
<title>Static checks - Red Hat OpenShift Operators</title>
<link href="../../assets/stylesheets/main.342714a4.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#static-check">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Red Hat OpenShift Operators" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Red Hat OpenShift Operators">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Red Hat OpenShift Operators
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Static checks
            
          </span>
</div>
</div>
</div>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/redhat-openshift-ecosystem/operator-pipelines" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    operator-pipelines
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Overview

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../pipelines_overview/">
          
  
  
  Operator pipelines

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="./">
          
  
  
  Tests

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../contributing-prerequisites/">
          
  
  
  Operators

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../pipeline-admin-guide/">
          
  
  
  Admin

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Red Hat OpenShift Operators" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Red Hat OpenShift Operators">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Red Hat OpenShift Operators
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/redhat-openshift-ecosystem/operator-pipelines" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    operator-pipelines
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Operator pipelines
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Operator pipelines
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../pipelines_overview/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../isv_pipelines/">
<span class="md-ellipsis">
    ISV operators
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../contributing-via-pr/">
<span class="md-ellipsis">
    Contributing via PR
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../operator-ci-yaml/">
<span class="md-ellipsis">
    Operator CI yaml
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../community-operators-troubleshooting/">
<span class="md-ellipsis">
    Troubleshooting for Community Operators
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-ellipsis">
    Tests
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Tests
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Static checks
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Static checks
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#isv-tests">
<span class="md-ellipsis">
      ISV tests
    </span>
</a>
<nav aria-label="ISV tests" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#check_pruned_graph-warning">
<span class="md-ellipsis">
      check_pruned_graph (Warning)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#check_marketplace_annotation">
<span class="md-ellipsis">
      check_marketplace_annotation
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#community-tests">
<span class="md-ellipsis">
      Community tests
    </span>
</a>
<nav aria-label="Community tests" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#check_osdk_bundle_validate_operatorhub">
<span class="md-ellipsis">
      check_osdk_bundle_validate_operatorhub
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#check_osdk_bundle_validate_operator_framework">
<span class="md-ellipsis">
      check_osdk_bundle_validate_operator_framework
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#check_required_fields">
<span class="md-ellipsis">
      check_required_fields
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#check_dangling_bundles">
<span class="md-ellipsis">
      check_dangling_bundles
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#check_api_version_constraints">
<span class="md-ellipsis">
      check_api_version_constraints
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#check_upgrade_graph_loop">
<span class="md-ellipsis">
      check_upgrade_graph_loop
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#check_replaces_availability">
<span class="md-ellipsis">
      check_replaces_availability
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#check_operator_name_unique">
<span class="md-ellipsis">
      check_operator_name_unique
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#check_ci_upgrade_graph">
<span class="md-ellipsis">
      check_ci_upgrade_graph
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-tests">
<span class="md-ellipsis">
      Common tests
    </span>
</a>
<nav aria-label="Common tests" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#check_operator_name-warning">
<span class="md-ellipsis">
      check_operator_name (Warning)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#check_bundle_images_in_fbc">
<span class="md-ellipsis">
      check_bundle_images_in_fbc
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#check_schema_bundle_release_config">
<span class="md-ellipsis">
      check_schema_bundle_release_config
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#check_schema_operator_ci_config">
<span class="md-ellipsis">
      check_schema_operator_ci_config
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#check_catalog_usage_ci_config">
<span class="md-ellipsis">
      check_catalog_usage_ci_config
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#check_olm_bundle_object_in_fbc">
<span class="md-ellipsis">
      check_olm_bundle_object_in_fbc
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#running-tests-locally">
<span class="md-ellipsis">
      Running tests locally
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../dynamic_checks/">
<span class="md-ellipsis">
    Dynamic checks
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Operators
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Operators
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../contributing-prerequisites/">
<span class="md-ellipsis">
    Before submitting your Operator
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../contributing-where-to/">
<span class="md-ellipsis">
    Where to place operator
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../best-practices/">
<span class="md-ellipsis">
    Best practices
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../fbc_onboarding/">
<span class="md-ellipsis">
    File based catalog onboarding
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../fbc_workflow/">
<span class="md-ellipsis">
    File based catalog workflow
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../fbc_autorelease/">
<span class="md-ellipsis">
    File based catalog auto-release
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../packaging-required-criteria-ocp/">
<span class="md-ellipsis">
    OKD/OpenShift Catalogs criteria and options
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Admin
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Admin
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../pipeline-admin-guide/">
<span class="md-ellipsis">
    Admin guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../catalog_image_browser/">
<span class="md-ellipsis">
    Catalog image browser
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../fbc-catalog-promotion/">
<span class="md-ellipsis">
    FBC catalog promotion
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="static-check">Static check</h1>
<p>The operator pipelines want to make sure the operator that will be released to
OpenShift operator catalog follows a best practices and meet certain standards
that we expect from an operator.</p>
<p>In order to meet these standards a series of static checks have been created for
each stream of operators. The static checks are executed for each operator
submission and reports warning or failures with an description of what is wrong
and suggestion on how to fix it.</p>
<p>Here is the example how the result will look like in the PR:</p>
<p><img alt="Static test result example" src="../../img/static_tests_example.png"/></p>
<h2 id="isv-tests">ISV tests</h2>
<h4 id="check_pruned_graph-warning">check_pruned_graph (Warning)</h4>
<p>This test make sure the operator update graph is not accidentally pruned by
introducing operator configuration that prunes graph as a unwanted side effect.</p>
<p>The unintentional graph pruning happens when olm.skipRange annotation is set
but replaces field is not set in the CSV. The definition may lead to unintentional
<a href="https://olm.operatorframework.io/docs/concepts/olm-architecture/operator-catalog/creating-an-update-graph/#skiprange">pruning of the update graph</a>.</p>
<p>If this is intentional, you can skip the check
by adding <code>/test skip check_pruned_graph</code> comment to a pull request.</p>
<h4 id="check_marketplace_annotation">check_marketplace_annotation</h4>
<p>The marketplace operators requires additional metadata in order to be properly
displayed in the Marketplace ecosystem.</p>
<p>There are 2 required fields in the operator <code>clusterserviceversion</code> that need
to be filled and need to have specific value:</p>
<ul>
<li><code>metadata.annotations.marketplace.openshift.io/remote-workflow</code><ul>
<li>Value template: <code>https://marketplace.redhat.com/en-us/operators/{annotation_package}/pricing?utm_source=openshift_console</code></li>
</ul>
</li>
<li><code>metadata.annotations.marketplace.openshift.io/support-workflow</code><ul>
<li>Value template: <code>https://marketplace.redhat.com/en-us/operators/{annotation_package}/support?utm_source=openshift_console</code></li>
</ul>
</li>
</ul>
<p>Where <code>{annotation_package}</code> matches <code>operators.operatorframework.io.bundle.package.v1</code>
from <code>metadata/annotation.yaml</code> file.</p>
<p>The test is only executed for operators submitted inside the <a href="https://github.com/redhat-openshift-ecosystem/redhat-marketplace-operators">Red Hat marketplace repo</a>.</p>
<h2 id="community-tests">Community tests</h2>
<h4 id="check_osdk_bundle_validate_operatorhub">check_osdk_bundle_validate_operatorhub</h4>
<p>The test is based on <code>operator-sdk bundle validate</code> command with <code>name=operatorhub</code> test suite <a href="https://sdk.operatorframework.io/docs/cli/operator-sdk_bundle_validate/#operator-sdk-bundle-validate">(link)</a>.</p>
<h4 id="check_osdk_bundle_validate_operator_framework">check_osdk_bundle_validate_operator_framework</h4>
<p>The test is based on <code>operator-sdk bundle validate</code> command with <code>suite=operatorframework</code> test suite <a href="https://sdk.operatorframework.io/docs/cli/operator-sdk_bundle_validate/#operator-sdk-bundle-validate">(link)</a>.</p>
<h4 id="check_required_fields">check_required_fields</h4>
<table>
<thead>
<tr>
<th>Field name</th>
<th>Validation</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>spec.displayName</code></td>
<td><code>.{3,50}</code></td>
<td>A string with 3 - 50 characters</td>
</tr>
<tr>
<td><code>spec.description</code></td>
<td><code>.{20,}</code></td>
<td>A bundle description with at least 20 characters</td>
</tr>
<tr>
<td><code>spec.icon</code></td>
<td><code>media</code></td>
<td>A valid base64 content with a supported media type (<code>{"base64data": &lt;b64 content&gt;, "mediatype": enum["image/png", "image/jpeg", "image/gif", "image/svg+xml"]}</code>)</td>
</tr>
<tr>
<td><code>spec.version</code></td>
<td><code>SemVer</code></td>
<td>Valid semantic version</td>
</tr>
<tr>
<td><code>spec.maintainers</code></td>
<td></td>
<td>At least 1 maintainer contacts. Example: <code>{"name": "User 123", "email": "user@redhat.com"}</code></td>
</tr>
<tr>
<td><code>spec.provider.name</code></td>
<td><code>.{3,}</code></td>
<td>A string with at least 3 characters</td>
</tr>
<tr>
<td><code>spec.links</code></td>
<td></td>
<td>At least 1 link. Example: <code>{"name": "Documentation", "url": "https://redhat.com"}</code></td>
</tr>
</tbody>
</table>
<h4 id="check_dangling_bundles">check_dangling_bundles</h4>
<p>The test prevents from releasing an operator and keeping any previous bundle dangling.
A dangling bundle is a bundle that is not referenced by any other bundle and is
not a HEAD of a channel.</p>
<p>In the example bellow the <code>v1.3</code> bundle is dangling.</p>
<div class="mermaid">graph LR
    A(v1.0) --&gt;B(v1.1)
    B --&gt; C(v1.2)
    B --&gt; E(v1.3)
    C --&gt; D(v1.4 - HEAD)
</div>
<h4 id="check_api_version_constraints">check_api_version_constraints</h4>
<p>The test verifies a consistency between value <code>com.redhat.openshift.versions</code> from
annotation with <code>spec.minKubeVersion</code>. In case a an operator targets specific version
of OpenShift and at the same time sets minimal kube version that is higher than
the one supported by the OCP. The test raises an error.</p>
<p>Example:</p>
<p>Following combination is not valid since the OCP 4.9 is based on 1.22 Kubernetes.</p>
<pre><code>spec.minKubeVersion: 1.23

com.redhat.openshift.versions: 4.9-4.15
</code></pre>
<h4 id="check_upgrade_graph_loop">check_upgrade_graph_loop</h4>
<p>The purpose of this test is to check whether there are any loops in the upgrade graph.</p>
<p>As stated on the graph below the edge between <code>v1.2</code> and <code>v1.0</code> introduces
a loop in the graph.</p>
<div class="mermaid">graph LR
    A(v1.0) --&gt;B(v1.1)
    B --&gt; C(v1.2)
    C --&gt; D(v1.3)
    C --&gt; A
</div>
<h4 id="check_replaces_availability">check_replaces_availability</h4>
<p>The test aims to verify if a bundle referenced by the <code>replaces</code> value is available in all
catalog version where the given bundle is going to be released to. The list of
catalog version is determined by the <code>com.redhat.openshift.versions</code> annotation if present.
If the annotation is not present the bundle targets all supported ocp version.</p>
<p>To fix the issue either change a range of versions where a bundle is going to be
released by updating the annotation or change the <code>replaces</code> value.</p>
<h4 id="check_operator_name_unique">check_operator_name_unique</h4>
<p>The test makes sure the operator is consistent when using operator names as defined
in the <code>clusterserviceversion</code>. It is not allowed to have multiple bundle names for
a single operator. The source of the value is at <code>csv.metadata.name</code>.</p>
<h4 id="check_ci_upgrade_graph">check_ci_upgrade_graph</h4>
<p>The test verifies a content of the <code>ci.yaml</code> file and make sure only allowed values are
used for <code>updateGraph</code> key. The currently supported values are: <code>["replaces-mode", "semver-mode"]</code>.</p>
<h2 id="common-tests">Common tests</h2>
<h4 id="check_operator_name-warning">check_operator_name (Warning)</h4>
<p>The test verifies a consistency between operator name annotation and operator
name in the CSV definition. The source of these values are:</p>
<ul>
<li><code>operators.operatorframework.io.bundle.package.v1</code> (<code>metadata/annotation.yaml</code>)</li>
<li><code>csv.metadata.name</code> - the name without a version (<code>manifests/.*.clusterserviceversion.yaml</code>)</li>
</ul>
<h4 id="check_bundle_images_in_fbc">check_bundle_images_in_fbc</h4>
<p>This check will ensure that all bundle images in the file based catalog for given
operator catalog(s) use allowed image registry. Allowed registries are configured
in <code>(repo_root)/config.yaml</code> under the key <code>allowed_bundle_registries</code>.</p>
<h4 id="check_schema_bundle_release_config">check_schema_bundle_release_config</h4>
<p>The test validates the <code>release-config.yaml</code> file against the schema. The file description
including the schema definition can be found <a href="../fbc_autorelease/#release-configyaml">here</a>.</p>
<h4 id="check_schema_operator_ci_config">check_schema_operator_ci_config</h4>
<p>The test validates the <code>ci.yaml</code> file against the schema. The schema definition can
be found<a href="https://github.com/redhat-openshift-ecosystem/operator-pipelines/blob/main/operator-pipeline-images/operatorcert/schemas/ci-schema.json">here</a>.</p>
<h4 id="check_catalog_usage_ci_config">check_catalog_usage_ci_config</h4>
<p>The test makes sure the <code>fbc.catalog_mapping</code> in <code>ci.yaml</code> file is not mapping a single
catalog to multiple catalog templates. The test will fail if the same catalog is used
in multiple templates.</p>
<p>Example of the <code>ci.yaml</code> file where <code>v4.14</code> catalog is used in two different templates.</p>
<pre><code class="language-yaml">---
fbc:
  enabled: true

  catalog_mapping:
    - template_name: basic.yaml
      catalog_names: ["v4.14", "v4.15", "v4.16"]
      type: olm.template.basic
    - template_name: semver.yaml
      catalog_names: ["v4.13", "v4.14"] # The 4.14 is already used in the basic.yaml template
      type: olm.semver
</code></pre>
<h4 id="check_olm_bundle_object_in_fbc">check_olm_bundle_object_in_fbc</h4>
<p>The test verifies a presence of <code>olm.bundle.object</code> in the catalog's bundle properties.
For catalogs <code>&gt;=v4.17</code> the <code>olm.bundle.object</code> is not allowed as it has negative
impact on performance of the OpenShift olm.</p>
<p>The test will fail if the <code>olm.bundle.object</code> is present in the catalog within
the <code>/catalogs/{ocp_version}/{operator_name}/catalog.yaml</code> file.</p>
<p>To prevent the test from failing download the latest <a href="https://raw.githubusercontent.com/redhat-openshift-ecosystem/operator-pipelines/main/fbc/Makefile">Makefile</a>
and re-render the catalog again with <code>make catalogs</code> command. The Makefile uses
extra arguments <code>--migrate-level bundle-object-to-csv-metadata</code> for opm when rendering
catalogs for <code>&gt;=4.17</code> version.</p>
<h2 id="running-tests-locally">Running tests locally</h2>
<pre><code class="language-bash"># Install the package with static checks
$ pip install git+https://github.com/redhat-openshift-ecosystem/operator-pipelines.git

# Execute a test suite
# In this example tests are executed for aqua operator
# with 2022.4.15 version and two operator catalogs (v4.17/aqua and v4.18/aqua)
$ python static-tests \
    --repo-path ~/community-operators-prod \
    --suites operatorcert.static_tests.community \
    --output-file /tmp/operator-test.json \
    --verbose \
    aqua 2022.4.15 v4.17/aqua,v4.18/aqua

</code></pre>
<pre><code class="language-javascript">$ cat /tmp/operator-test.json | jq

{
  "passed": false,
  "outputs": [
    {
      "type": "error",
      "message": "Channel 2022.4.0 has dangling bundles: {Bundle(aqua/2022.4.14)}",
      "test_suite": "operatorcert.static_tests.community",
      "check": "check_dangling_bundles"
    },
    {
      "type": "warning",
      "message": "Warning: Value aquasecurity.github.io/v1alpha1, Kind=ClusterConfigAuditReport: provided API should have an example annotation",
      "test_suite": "operatorcert.static_tests.community",
      "check": "check_osdk_bundle_validate_operator_framework"
    },
    {
      "type": "warning",
      "message": "Warning: Value aquasecurity.github.io/v1alpha1, Kind=AquaStarboard: provided API should have an example annotation",
      "test_suite": "operatorcert.static_tests.community",
      "check": "check_osdk_bundle_validate_operator_framework"
    },
    {
      "type": "warning",
      "message": "Warning: Value aquasecurity.github.io/v1alpha1, Kind=ConfigAuditReport: provided API should have an example annotation",
      "test_suite": "operatorcert.static_tests.community",
      "check": "check_osdk_bundle_validate_operator_framework"
    },
    {
      "type": "warning",
      "message": "Warning: Value : (aqua-operator.v2022.4.15) csv.Spec.minKubeVersion is not informed. It is recommended you provide this information. Otherwise, it would mean that your operator project can be distributed and installed in any cluster version available, which is not necessarily the case for all projects.",
      "test_suite": "operatorcert.static_tests.community",
      "check": "check_osdk_bundle_validate_operator_framework"
    },
    {
      "type": "warning",
      "message": "Warning: Value : (aqua-operator.v2022.4.15) csv.Spec.minKubeVersion is not informed. It is recommended you provide this information. Otherwise, it would mean that your operator project can be distributed and installed in any cluster version available, which is not necessarily the case for all projects.",
      "test_suite": "operatorcert.static_tests.community",
      "check": "check_osdk_bundle_validate_operator_framework"
    },
    {
      "type": "warning",
      "message": "Warning: Value aqua-operator.v2022.4.15: this bundle is using APIs which were deprecated and removed in v1.25. More info: https://kubernetes.io/docs/reference/using-api/deprecation-guide/#v1-25. Migrate the API(s) for podsecuritypolicies: ([\"ClusterServiceVersion.Spec.InstallStrategy.StrategySpec.ClusterPermissions[2].Rules[7]\"])",
      "test_suite": "operatorcert.static_tests.community",
      "check": "check_osdk_bundle_validate_operator_framework"
    },
    {
      "type": "warning",
      "message": "Warning: Value aqua-operator.v2022.4.15: this bundle is using APIs which were deprecated and removed in v1.25. More info: https://kubernetes.io/docs/reference/using-api/deprecation-guide/#v1-25. Migrate the API(s) for podsecuritypolicies: ([\"ClusterServiceVersion.Spec.InstallStrategy.StrategySpec.ClusterPermissions[2].Rules[7]\"])",
      "test_suite": "operatorcert.static_tests.community",
      "check": "check_osdk_bundle_validate_operator_framework"
    },
    {
      "type": "warning",
      "message": "Warning: Value aqua-operator.v2022.4.15: unable to find the resource requests for the container: (aqua-operator). It is recommended to ensure the resource request for CPU and Memory. Be aware that for some clusters configurations it is required to specify requests or limits for those values. Otherwise, the system or quota may reject Pod creation. More info: https://master.sdk.operatorframework.io/docs/best-practices/managing-resources/",
      "test_suite": "operatorcert.static_tests.community",
      "check": "check_osdk_bundle_validate_operator_framework"
    },
    {
      "type": "warning",
      "message": "Warning: Value aquasecurity.github.io/v1alpha1, Kind=ConfigAuditReport: provided API should have an example annotation",
      "test_suite": "operatorcert.static_tests.community",
      "check": "check_osdk_bundle_validate_operatorhub"
    },
    {
      "type": "warning",
      "message": "Warning: Value : (aqua-operator.v2022.4.15) csv.Spec.minKubeVersion is not informed. It is recommended you provide this information. Otherwise, it would mean that your operator project can be distributed and installed in any cluster version available, which is not necessarily the case for all projects.",
      "test_suite": "operatorcert.static_tests.community",
      "check": "check_osdk_bundle_validate_operatorhub"
    },
    {
      "type": "warning",
      "message": "Warning: Value : (aqua-operator.v2022.4.15) csv.Spec.minKubeVersion is not informed. It is recommended you provide this information. Otherwise, it would mean that your operator project can be distributed and installed in any cluster version available, which is not necessarily the case for all projects.",
      "test_suite": "operatorcert.static_tests.community",
      "check": "check_osdk_bundle_validate_operatorhub"
    },
    {
      "type": "warning",
      "message": "Warning: Value aqua-operator.v2022.4.15: this bundle is using APIs which were deprecated and removed in v1.25. More info: https://kubernetes.io/docs/reference/using-api/deprecation-guide/#v1-25. Migrate the API(s) for podsecuritypolicies: ([\"ClusterServiceVersion.Spec.InstallStrategy.StrategySpec.ClusterPermissions[2].Rules[7]\"])",
      "test_suite": "operatorcert.static_tests.community",
      "check": "check_osdk_bundle_validate_operatorhub"
    },
    {
      "type": "warning",
      "message": "Warning: Value : The \"operatorhub\" validator is deprecated; for equivalent validation use \"operatorhub/v2\", \"standardcapabilities\" and \"standardcategories\" validators",
      "test_suite": "operatorcert.static_tests.community",
      "check": "check_osdk_bundle_validate_operatorhub"
    },
    {
      "type": "error",
      "message": "Invalid bundle image(s) found in OperatorCatalog(v4.17/aqua):
      quay.io/invalid-repository/aqua@sha256:123. Only these registries are allowed for bundle images: quay.io/allowed-repository/, registry.connect.redhat.com/.",
      "test_suite": "operatorcert.static_tests.common",
      "check": "check_bundle_images_in_fbc"
    }
  ]
}

</code></pre>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "toc.integrate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({});</script></body>
</html>