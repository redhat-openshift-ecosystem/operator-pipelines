---
# Given an operator name and bundle version, return the path to the operator and bundle directories
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: get-paths-from-name-and-version
spec:
  params:
    - name: pipeline_image
    - name: operator_name
      description: Name of the operator
    - name: bundle_version
      description: Version of the bundle
  results:
    - name: operator_path
      description: Path to the directory containing the operator
    - name: bundle_path
      description: Path to the directory containing the bundle
  steps:
    - name: compose-path
      image: "$(params.pipeline_image)"
      script: |
        #! /usr/bin/env bash
        set -xe

        operator_name="$(params.operator_name)"
        bundle_version="$(params.bundle_version)"

        if [ -n "${operator_name}" ] ; then
          echo -n "operators/${operator_name}" >"$(results.operator_path.path)"
          if [ -n "${bundle_version}" ] ; then
            echo -n "operators/${operator_name}/${bundle_version}" >"$(results.bundle_path.path)"
          else
            echo -n >"$(results.bundle_path.path)"
          fi
        else
          echo -n >"$(results.operator_path.path)"
          echo -n >"$(results.bundle_path.path)"
        fi
