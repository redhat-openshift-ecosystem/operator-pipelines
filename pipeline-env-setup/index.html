
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Pipeline Environment Setup - Red Hat OpenShift Operators</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pipeline-environment-setup" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Red Hat OpenShift Operators" class="md-header__button md-logo" aria-label="Red Hat OpenShift Operators" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Red Hat OpenShift Operators
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pipeline Environment Setup
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/redhat-openshift-ecosystem/operator-pipelines" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    operator-pipelines
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../users/pipelines_overview/" class="md-tabs__link">
          
  
  
  Operator pipelines

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../users/static_checks/" class="md-tabs__link">
          
  
  
  Tests

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../users/contributing-prerequisites/" class="md-tabs__link">
          
  
  
  Operators

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../pipeline-admin-guide/" class="md-tabs__link">
          
  
  
  Admin

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Red Hat OpenShift Operators" class="md-nav__button md-logo" aria-label="Red Hat OpenShift Operators" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Red Hat OpenShift Operators
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/redhat-openshift-ecosystem/operator-pipelines" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    operator-pipelines
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Operator pipelines
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Operator pipelines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users/pipelines_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users/isv_pipelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ISV operators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users/contributing-via-pr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing via PR
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users/operator-ci-yaml/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Operator CI yaml
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users/community-operators-troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting for Community Operators
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tests
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tests
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users/static_checks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Static checks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users/dynamic_checks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dynamic checks
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Operators
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Operators
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users/contributing-prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Before submitting your Operator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users/contributing-where-to/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Where to place operator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users/best-practices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Best practices
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users/fbc_onboarding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File based catalog onboarding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users/fbc_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File based catalog workflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users/fbc_autorelease/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File based catalog auto-release
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users/packaging-required-criteria-ocp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OKD/OpenShift Catalogs criteria and options
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Admin
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Admin
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline-admin-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Admin guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../catalog_image_browser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Catalog image browser
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fbc-catalog-promotion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FBC catalog promotion
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="pipeline-environment-setup">Pipeline Environment Setup</h1>
<p><a href="#common-for-all-the-pipelines">Common for all the pipelines</a></p>
<p><a href="#only-ci-pipeline">Only CI Pipeline</a></p>
<p><a href="#only-hosted-pipeline">Only Hosted Pipeline</a></p>
<p><a href="#only-release-pipeline">Only Release Pipeline</a></p>
<h2 id="common-for-all-the-pipelines">Common for all the pipelines:</h2>
<h3 id="red-hat-catalog-imagestreams">Red Hat Catalog Imagestreams</h3>
<p>The pipelines must pull the parent index images through the internal OpenShift
registry to take advantage of the built-in credentials for Red Hat's terms-based
registry (registry.redhat.io). This saves the user from needing to provide such
credentials. The index generation task will always pull published index images
through imagestreams of the same name in the current namespace. As a result,
there is a one time configuration for each desired distribution catalog. Replace
the <code>from</code> argument when configuring this for pre-production environments.</p>
<pre><code class="language-bash"># Must be run once before certifying against the certified catalog.
oc --request-timeout 10m import-image certified-operator-index \
  --from=registry.redhat.io/redhat/certified-operator-index \
  --reference-policy local \
  --scheduled \
  --confirm \
  --all

# Must be run once before certifying against the Red Hat Marketplace catalog.
oc --request-timeout 10m import-image redhat-marketplace-index \
  --from=registry.redhat.io/redhat/redhat-marketplace-index \
  --reference-policy local \
  --scheduled \
  --confirm \
  --all
</code></pre>
<h2 id="only-ci-pipeline">Only CI pipeline:</h2>
<h3 id="registry-credentials">Registry Credentials</h3>
<p>The CI pipeline can optionally be configured to push and pull images to/from a remote
private registry. The user must create an auth secret containing the docker config.
This secret can then be passed as a workspace named <code>registry-credentials</code> when invoking
the pipeline.</p>
<pre><code class="language-bash">oc create secret generic registry-dockerconfig-secret \
  --type kubernetes.io/dockerconfigjson \
  --from-file .dockerconfigjson=config.json
</code></pre>
<h3 id="git-ssh-secret">Git SSH Secret</h3>
<p>The pipelines requires git SSH credentials with
write access to the repository if automatic digest pinning
is enabled using the pin_digests param. This is disabled
by default. Before executing the pipeline the user must
create a secret in the same namespace as the pipeline.</p>
<p>To create the secret run the following commands (substituting your key):</p>
<pre><code class="language-bash">cat &lt;&lt; EOF &gt; ssh-secret.yml
kind: Secret
apiVersion: v1
metadata:
  name: github-ssh-credentials
data:
  id_rsa: |
    &lt; PRIVATE SSH KEY &gt;
EOF

oc create -f ssh-secret.yml
</code></pre>
<h3 id="container-api-access">Container API access</h3>
<p>CI pipelines automatically upload a test results, logs and artifacts using Red Hat
container API. This requires a partner's API key and the key needs to be created
as a secret in OpenShift cluster before running a Tekton pipeline.</p>
<pre><code class="language-bash">oc create secret generic pyxis-api-secret --from-literal pyxis_api_key=&lt; API KEY &gt;
</code></pre>
<h3 id="kubeconfig">Kubeconfig</h3>
<p>The CI pipeline requires a kubeconfig with admin credentials. This can be created
by logging into said cluster as an admin user.</p>
<pre><code class="language-bash">KUBECONFIG=kubeconfig oc login -u &lt;username&gt; -p &lt;password&gt;
oc create secret generic kubeconfig --from-file=kubeconfig=kubeconfig
</code></pre>
<h3 id="github-api-token">GitHub API token</h3>
<p>To automatically open the PR with submission, pipeline must authenticate to GitHub.
Secret containing api token should be created.</p>
<pre><code class="language-bash">oc create secret generic github-api-token --from-literal GITHUB_TOKEN=&lt; GITHUB TOKEN &gt;
</code></pre>
<h2 id="only-hosted-pipeline">Only Hosted pipeline:</h2>
<h3 id="registry-credentials_1">Registry Credentials</h3>
<p>The hosted pipeline requires credentials to push/pull bundle and index images
from a pre-release registry (quay.io). A registry auth secret must be created.
This secret can then be passed as a workspace named <code>registry-credentials</code> when
invoking the pipeline.</p>
<pre><code class="language-bash">oc create secret generic hosted-pipeline-registry-auth-secret \
  --type kubernetes.io/dockerconfigjson \
  --from-file .dockerconfigjson=config.json
</code></pre>
<h3 id="container-api-access_1">Container API access</h3>
<p>The hosted pipeline communicates with internal Container API that requires cert + key.
The corresponding secret needs to be created before running the pipeline.</p>
<pre><code class="language-bash">oc create secret generic operator-pipeline-api-certs \
  --from-file operator-pipeline.pem \
  --from-file operator-pipeline.key
</code></pre>
<h3 id="hydra-credentials">Hydra credentials</h3>
<p>To verify publishing checklist, Hosted pipeline uses Hydra API. To authenticate
with Hydra over basic auth, secret containing service account credentials
should be created.</p>
<pre><code class="language-bash">oc create secret generic hydra-credentials \
  --from-literal username=&lt;username&gt;  \
  --from-literal password=&lt;password&gt;
</code></pre>
<h3 id="github-bot-token">GitHub Bot token</h3>
<p>To automatically merge the PR, Hosted pipeline uses GitHub API. To authenticate
when using this method, secret containing bot token should be created.</p>
<pre><code class="language-bash">oc create secret generic github-bot-token --from-literal github_bot_token=&lt; BOT TOKEN &gt;
</code></pre>
<h3 id="prow-kubeconfig">Prow-kubeconfig</h3>
<p>Hosted preflight tests are run on the separate cluster. To provision a cluster
destined for the tests, the pipeline uses a Prowjob. Thus, to start
the preflight test, there needs to be a prow-specific kubeconfig.</p>
<ul>
<li><a href="https://github.com/kubernetes/test-infra/tree/master/prow">ProwJob</a></li>
<li><a href="https://docs.ci.openshift.org/docs/architecture/ci-operator/">OperatorCI</a></li>
</ul>
<pre><code class="language-bash">oc create secret generic prow-kubeconfig \
  --from-literal kubeconfig=&lt;kubeconfig&gt;
</code></pre>
<h3 id="preflight-decryption-key">Preflight decryption key</h3>
<p>Results of the preflight tests are protected by encryption. In order to
retrieve them from the preflight job, gpg decryption key should be supplied.</p>
<pre><code class="language-bash">oc create secret generic preflight-decryption-key \
  --from-literal private=&lt;private gpg key&gt; \
  --from-literal public=&lt;public gpg key&gt;
</code></pre>
<h3 id="quay-oauth-token">Quay OAuth Token</h3>
<p>A Quay OAuth token is required to set repo visibility to public.</p>
<pre><code class="language-bash">oc create secret generic quay-oauth-token --from-literal token=&lt;token&gt;
</code></pre>
<h2 id="only-release-pipeline">Only Release pipeline:</h2>
<h3 id="registry-credentials_2">Registry Credentials</h3>
<p>The release pipeline requires credentials to push and pull the bundle image built by
the hosted pipeline. Three registry auth secrets must be specified since different
credentials may be required for the same registry when copying and serving the image.
These secrets can then be passed as workspaces named <code>registry-pull-credentials</code>,
<code>registry-push-credentials</code> and <code>registry-serve-credentials</code> when invoking the
pipeline.</p>
<pre><code class="language-bash">oc create secret generic release-pipeline-registry-auth-pull-secret \
  --type kubernetes.io/dockerconfigjson \
  --from-file .dockerconfigjson=pull-config.json

oc create secret generic release-pipeline-registry-auth-push-secret \
  --type kubernetes.io/dockerconfigjson \
  --from-file .dockerconfigjson=push-config.json

oc create secret generic release-pipeline-registry-auth-serve-secret \
  --type kubernetes.io/dockerconfigjson \
  --from-file .dockerconfigjson=serve-config.json
</code></pre>
<h3 id="kerberos-credentials">Kerberos credentials</h3>
<p>For submitting the IIB build, you need kerberos keytab in a secret:</p>
<pre><code class="language-bash">oc create secret generic kerberos-keytab \
  --from-file krb5.keytab
</code></pre>
<h3 id="quay-credentials">Quay credentials</h3>
<p>Release pipeline uses Quay credentials to authenticate a push to an index image
during the IIB build.</p>
<pre><code class="language-bash">oc create secret generic iib-quay-credentials \
  --from-literal username=&lt;QUAY_USERNAME&gt; \
  --from-literal password=&lt;QUAY_PASSWORD&gt;
</code></pre>
<h3 id="ocp-registry-kubeconfig">OCP-registry-kubeconfig</h3>
<p>OCP clusters contains the public registries for Operator Bundle Images.
To publish the image to this registry, Pipeline connects to OCP cluster via
kubeconfig.
To create the secret which contains the OCP cluster kubeconfig:</p>
<pre><code class="language-bash">oc create secret generic ocp-registry-kubeconfig \
  --from-literal kubeconfig=&lt;kubeconfig&gt;
</code></pre>
<p>Additional setup instructions for this cluster are documented <a href="rhc4tp-cluster.md">here</a>.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "toc.integrate"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>